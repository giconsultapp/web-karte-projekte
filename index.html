<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="stylesheet" href="css/leaflet.css" />
    <link rel="stylesheet" href="css/qgis2web.css" />
    <link rel="stylesheet" href="css/fontawesome-all.min.css" />
    <link rel="stylesheet" href="css/MarkerCluster.css" />
    <link rel="stylesheet" href="css/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="css/markers.css" />
    <link rel="stylesheet" href="css/leaflet-search.css" />
    <link rel="stylesheet" href="css/leaflet-control-geocoder.Geocoder.css" />
    <link rel="stylesheet" href="css/images/images.css" />
    <style>
      html,
      body,
      #map {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
      }
    </style>
    <title></title>
  </head>
  <body>
    <div id="category-menu">
      <div class="category-menu">
      <button class="category-button" data-category="alle">Alle</button>
      <button class="category-button" data-category="Bahnhof">Bahnhof</button>
      <button class="category-button" data-category="Streckennetz">Streckennetz</button>
      <button class="category-button" data-category="Tunnel">Tunnel</button>
    </div>
  </div>
    <div id="image-gallery">
      <div class="image-grid"></div>
    </div>
    <div id="map"></div>
    <script src="images-gallery.js"></script>
    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/rbush.min.js"></script>
    <script src="js/labelgun.min.js"></script>
    <script src="js/labels.js"></script>
    <script src="js/leaflet-control-geocoder.Geocoder.js"></script>
    <script src="js/leaflet.markercluster.js"></script>
    <script src="js/leaflet-search.js"></script>
    <script src="data/vg2500_bld_2.js"></script>
    <script src="data/Projekt_linie.geojson"></script>
    <script src="data/Projekt_punkt.geojson"></script>
    <script src="plugins/leaflet.snogylop.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.1/axios.min.js"></script>
    <script src="js/code/popUps.js"></script>
    <script src="js/code/OSM.js"></script>
    <script src="js/code/ORM.js"></script>
    <script src="js/code/utils/createMiddleMarkers.js"></script>
    <script src="js/code/highlightmap.js"></script>
    <script src="js/code/importData.js"></script>
    <script src="js/code/styles/layerStyles.js"></script>

    <script src="js/code/utils/filterFeaturesByCategory.js"></script>
    <script src="js/code/utils/calcMiddleLatLng.js"></script>
    <script src="js/code/utils/highlightFeature.js"></script>
    <script src="js/code/utils/filterSelection.js"></script>
    <script type="commonjs" src="../databasepg.js"></script>

    <script>

/* ----------------------- INITIALIZING ----------------------- */

// Initialize main map object
var map = L.map("map", {
  zoomControl: true,
  maxZoom: 24,
  minZoom: 6,
}).fitBounds([
  [37.51641700657241, 4.214943073930248],
  [60.89326383816825, 16.90230580792365],
]);

// Initialize default map tools
var hash = new L.Hash(map);
map.attributionControl.setPrefix(
  '<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>'
);
var autolinker = new Autolinker({
  truncate: { length: 30, location: "smart" },
});

// Initialize feature group
var bounds_group = new L.featureGroup([]);

/* ----------------------- ADD, NAME, AND STYLE LAYERS ----------------------- */

// OSM/ORM
map.createPane("pane_OpenStreetMap_0");
map.addLayer(layer_OpenStreetMap_0);
map.createPane("pane_OpenRailwayMap_1");
map.addLayer(layer_OpenRailwayMap_1);

// json_vg2500_bld_2
map.createPane("pane_vg2500_bld_2");
map.getPane("pane_vg2500_bld_2").style.zIndex = 402;
map.getPane("pane_vg2500_bld_2").style["mix-blend-mode"] = "normal";
const layer_vg2500_bld_2 = new L.geoJson(json_vg2500_bld_2, {
  attribution: "",
  invert: true,
  interactive: false,
  dataVar: "json_vg2500_bld_2",
  layerName: "layer_vg2500_bld_2",
  pane: "pane_vg2500_bld_2",
  onEachFeature: pop_vg2500_bld_2,
  style: style_vg2500_bld_2_0,
});
bounds_group.addLayer(layer_vg2500_bld_2);
map.addLayer(layer_vg2500_bld_2);

// layer_Projekt_linie
map.createPane("pane_Projekt_aktuell_linie_3");
map.getPane("pane_Projekt_aktuell_linie_3").style.zIndex = 403;
map.getPane("pane_Projekt_aktuell_linie_3").style["mix-blend-mode"] = "normal";
var layer_Projekt_linie = new L.geoJson(
  json_Projekt_linie,
  {
    attribution: "",
    interactive: true,
    dataVar: "json_Projekt_linie",
    layerName: "layer_Projekt_linie",
    pane: "pane_Projekt_aktuell_linie_3",
    onEachFeature: pop_Projekt_aktuell_linie_3,
    style: style_Projekt_aktuell_linie_3_0,
  }
);
bounds_group.addLayer(layer_Projekt_linie);
map.addLayer(layer_Projekt_linie);

// Middle markers
var middleMarkersGroup = L.layerGroup();
createMiddleMarkers(json_Projekt_linie);

// Merged layer
/*var mergedLayer = new L.geoJson(
  [json_Projekt_linie, json_Projekt_punkt],
  {
    attribution: "",  
    interactive: false,
    layerName: "mergedLayer",
  }
);
 mergedLayer.eachLayer((layer) => {
  if (layer.feature.geometry.type === "Point") {
    layer.setOpacity(0); // Hide points
  } 
});  
map.addLayer(mergedLayer);*/

//layer_Projekt_punkt
map.createPane("pane_Projekt_punkt");
map.getPane("pane_Projekt_punkt").style.zIndex = 404;
map.getPane("pane_Projekt_punkt").style["mix-blend-mode"] = "normal";
var layer_Projekt_punkt = new L.geoJson(
  json_Projekt_punkt,
  {
    attribution: "",
    interactive: true,
    dataVar: "json_Projekt_punkt",
    layerName: "layer_Projekt_punkt",
    pane: "pane_Projekt_punkt",
    onEachFeature: pop_Projekt_punkt,
    pointToLayer: function (feature, latlng) {
      var context = {
        feature: feature,
        variables: {},
      };
      return L.circleMarker(
        latlng,
        style_Projekt_punkt(feature)
      );
    },
  }
);

// Cluster
var cluster_Projekt_punkt = new L.MarkerClusterGroup({
  showCoverageOnHover: false,
  spiderfyDistanceMultiplier: 2,
});
cluster_Projekt_punkt.addLayer(layer_Projekt_punkt);
bounds_group.addLayer(layer_Projekt_punkt);
cluster_Projekt_punkt.addTo(map);

/* ----------------------- CONTROLS AND TOOLS ----------------------- */

// OSM geocoder
var osmGeocoder = new L.Control.Geocoder({
  collapsed: true,
  position: "topleft",
  text: "Search",
  title: "Testing",
}).addTo(map);
document.getElementsByClassName( 
  "leaflet-control-geocoder-icon"
)[0].className += " fa fa-search";
document.getElementsByClassName(
  "leaflet-control-geocoder-icon"
)[0].title += "Search for a place";

// Controls
var baseMaps = {};
L.control
  .layers(baseMaps, {
    '<img src="legend/Projekt_aktuell_punkt_4.png" /> Projekt_aktuell_punkt':
      cluster_Projekt_punkt,
    '<img src="legend/Projekt_aktuell_linie_3.png" /> Projekt_aktuell_linie':
      layer_Projekt_linie,
    '<img src="legend/vg2500_bld_2.png" /> vg2500_bld':
      layer_vg2500_bld_2,
    OpenRailwayMap: layer_OpenRailwayMap_1,
    OpenStreetMap: layer_OpenStreetMap_0,
  })
  .addTo(map);
map.addControl(
  new L.Control.Search({
    layer: mergedLayer,
    initial: false,
    hideMarkerOnCollapse: true,
    moveToLocation: (coords, title, map) => map.setView(coords, 10),
    propertyName: "Projektbezeichnung",
  })
);
document.getElementsByClassName("search-button")[0].className +=
  " fa fa-binoculars";
 
    </script>
  </body>
</html>